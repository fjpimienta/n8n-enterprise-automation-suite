<div class="page page-center bg-ice-gradient">
  <div class="container container-tight py-4">

    <div class="text-center mb-4">
      <div class="avatar avatar-xl rounded-circle bg-white shadow-sm p-3 mb-3 logo-container animate-fade-in">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon-logo" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
          <path d="M4 6.5l0 10.5l12.5 0a2.5 2.5 0 0 0 2.5 -2.5v-6.5l-4 -3l-5 0l-3 3z" />
          <path d="M11 9l2 -2" />
          <path d="M12 12l2 -2" />
          <path d="M4 17h13.8a2.2 2.2 0 0 1 2.2 2.2a1 1 0 0 1 -1 1h-14a1 1 0 0 1 -1 -1v-2.2" />
          <path d="M2 19h2" /> 
        </svg>
      </div>
      <h2 class="h2 text-center mt-2 mb-1 text-primary-dark">PistaHielo Operations</h2>
      <div class="text-muted">Control de Acceso & Punto de Venta</div>
    </div>

    <form class="card card-md border-0 shadow-lg touch-card" [formGroup]="loginForm" (ngSubmit)="onSubmit()">
      <div class="card-body p-4 p-md-5">
        <h2 class="card-title text-center mb-4 font-weight-bold">Iniciar Sesión</h2>

        @if (errorMessage()) {
        <div class="alert alert-danger d-flex align-items-center mb-3" role="alert">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
            <path d="M12 8v4" />
            <path d="M12 16h.01" />
          </svg>
          <div>{{ errorMessage() }}</div>
        </div>
        }

        <div class="mb-3">
          <label class="form-label text-muted small text-uppercase fw-bold">Empresa / Sucursal</label>
          
          <div class="input-group custom-input-group" [class.is-invalid-border]="isFieldInvalid('id_company')">
            <span class="input-group-text">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 21l18 0" /><path d="M5 21v-14l8 -4l8 4v14" /><path d="M19 21v-10l-6 -4" /></svg>
            </span>
            <select class="form-select" formControlName="id_company">
              <option value="" disabled selected>Seleccione una empresa...</option>
              @for (company of adminService.companies(); track company.id_company) {
                <option [value]="company.id_company">{{ company.company_name }}</option>
              }
            </select>
          </div>
          @if (isFieldInvalid('id_company')) {
            <div class="text-danger small mt-1">Seleccione una sucursal</div>
          }
        </div>

        <div class="mb-3">
          <label class="form-label text-muted small text-uppercase fw-bold">Usuario</label>
          <div class="input-group custom-input-group" [class.is-invalid-border]="isFieldInvalid('user')">
            <span class="input-group-text">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" /><path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" /></svg>
            </span>
            <input type="text" formControlName="user" class="form-control" placeholder="Ej. admin">
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label text-muted small text-uppercase fw-bold">Contraseña</label>
          <div class="input-group custom-input-group" [class.is-invalid-border]="isFieldInvalid('pass')">
            <span class="input-group-text">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3" /></svg>
            </span>
            <input [type]="showPassword() ? 'text' : 'password'" formControlName="pass" class="form-control" placeholder="••••••••">
            <span class="input-group-text cursor-pointer" (click)="togglePassword($event)">
              <a href="#" class="link-secondary" title="Ver contraseña" tabindex="-1">
                @if (showPassword()) {
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10.585 10.587a2 2 0 0 0 2.829 2.828" /><path d="M16.681 16.673a8.717 8.717 0 0 1 -4.681 1.327c-3.6 0 -6.6 -2 -9 -6c1.272 -2.12 3.145 -3.594 5.23 -4.381" /><path d="M3 3l18 18" /></svg>
                } @else {
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
                }
              </a>
            </span>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-check">
            <input type="checkbox" class="form-check-input" />
            <span class="form-check-label text-muted small">Recordar dispositivo</span>
          </label>
        </div>

        <div class="form-footer">
          <button type="submit" class="btn btn-primary w-100 btn-lg shadow-sm touch-button" 
            [disabled]="loginForm.invalid || isLoading()">
            @if (isLoading()) {
            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
            Verificando...
            } @else {
            Ingresar al Sistema
            }
          </button>
        </div>
      </div>
    </form>

    <div class="text-center text-muted mt-3 animate-fade-in">
      <div class="small">¿Olvidaste tu contraseña? <a href="#" class="text-primary" tabindex="-1">Contactar Soporte IT</a></div>
      <div class="h5 text-primary-dark mt-3 mb-0 font-weight-bold">By Hosting3M Suite</div>
      <div class="text-muted small">Gestión Operativa & Automatización</div>
    </div>

  </div>
</div>